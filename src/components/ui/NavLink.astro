---
type Props = {
  href: string;
  exact?: boolean;
  class?: string;
};

const { href, exact = false, class: className = "" } = Astro.props as Props;

const currentPath = Astro.url.pathname;

function normalizePath(p: string) {
  if (!p) return "/";
  return p.length > 1 && p.endsWith("/") ? p.slice(0, -1) : p;
}

const normalizedCurrent = normalizePath(currentPath);
const normalizedHref = normalizePath(href);

let isActive: boolean;
if (exact) {
  isActive = normalizedCurrent === normalizedHref;
} else {
  if (normalizedHref === "/") {
    isActive = normalizedCurrent === normalizedHref;
  } else {
    isActive =
      normalizedCurrent === normalizedHref ||
      normalizedCurrent.startsWith(normalizedHref + "/");
  }
}

const baseClasses = ["text-sm", "transition-colors"];

const stateClasses = isActive
  ? ["text-(--color-text-primary)", "font-medium"]
  : ["text-(--color-text-muted)", "hover:text-(--color-text-primary)"];

const classes = [...baseClasses, ...stateClasses, className].join(" ");
---

<a href={href} class={classes} aria-current={isActive ? "page" : undefined}>
  <slot />
</a>
